<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>TB10.1 Example Applications: examples/Multimedia/CameraExample/Camera_AppUi.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<h1>examples/Multimedia/CameraExample/Camera_AppUi.cpp</h1><a href="_camera___app_ui_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (c) 2007-2009 Nokia Corporation and/or its subsidiary(-ies).</span>
<a name="l00002"></a>00002 <span class="comment">// All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment">// This component and the accompanying materials are made available</span>
<a name="l00004"></a>00004 <span class="comment">// under the terms of "Eclipse Public License v1.0"</span>
<a name="l00005"></a>00005 <span class="comment">// which accompanies this distribution, and is available</span>
<a name="l00006"></a>00006 <span class="comment">// at the URL "http://www.eclipse.org/legal/epl-v10.html".</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Initial Contributors:</span>
<a name="l00009"></a>00009 <span class="comment">// Nokia Corporation - initial contribution.</span>
<a name="l00010"></a>00010 <span class="comment">//</span>
<a name="l00011"></a>00011 <span class="comment">// Contributors:</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">// Description:</span>
<a name="l00014"></a>00014 <span class="comment">// This  file handles application-wide aspects of the application's UI</span>
<a name="l00015"></a>00015 <span class="comment">// such as the menu bar, opening and closing files and </span>
<a name="l00016"></a>00016 <span class="comment">// exiting the application cleanly.</span>
<a name="l00017"></a>00017 <span class="comment">// The code demonstrates how to perform basic and advanced operations on a camera using ECam.</span>
<a name="l00018"></a>00018 <span class="comment">// Symbian does not provide the plugins for implementation of camera API. So this example runs</span>
<a name="l00019"></a>00019 <span class="comment">// only if the kit you are using supports camera implementation.</span>
<a name="l00020"></a>00020 <span class="comment">//</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="_camera_example_8h.html">CameraExample.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;ecamuids.hrh&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;ecom/ecomresolverparams.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;ecamadvsettings.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;icl/imagedata.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;camerahistogram.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="_camera___app_ui_8cpp.html#4aca57bb700e3d2491e72db6c34d9a4f">00035</a> <span class="keyword">const</span> TInt <a class="code" href="_camera___app_ui_8cpp.html#4aca57bb700e3d2491e72db6c34d9a4f">KMaxErrLength</a> = 50;
<a name="l00036"></a><a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">00036</a> TInt <a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">// List of Info messages</span>
<a name="l00039"></a>00039 _LIT(KErrorFormat,<span class="stringliteral">"Error - %d (%S)"</span>);
<a name="l00040"></a>00040 _LIT(KFeatureNotSupported, <span class="stringliteral">"This feature is not supported by the camera implementation"</span>);
<a name="l00041"></a>00041 _LIT(KError,<span class="stringliteral">"\n Could not create the camera object due to either insufficient memory, out of bounds camera index or capability"</span>);
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 _LIT(KNotSupported, <span class="stringliteral">"Not supported. So cannot be set. Try to set another value"</span>);
<a name="l00044"></a>00044 _LIT(KSupportedFocusModes, <span class="stringliteral">"Getting supported focus modes"</span>);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 _LIT(KPrepareImageCaptureErr, <span class="stringliteral">"PrepareImageCaptureL() failed"</span>);
<a name="l00047"></a>00047 _LIT(KPrepareVideoCaptureErr, <span class="stringliteral">"PrepareVideoCaptureL() failed"</span>);
<a name="l00048"></a>00048 _LIT(KImageSize, <span class="stringliteral">"Capturing image of size %d x %d"</span>);
<a name="l00049"></a>00049 _LIT(KVideoCapture, <span class="stringliteral">"Capturing video with capture rate %f and size % d x %d"</span>);
<a name="l00050"></a>00050 _LIT(KErrMessage,<span class="stringliteral">"CCameraAppUi::ImageBufferReady"</span>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 _LIT(KFocusModeSet, <span class="stringliteral">"Setting the focus mode successful"</span>);
<a name="l00053"></a>00053 _LIT(KFocusModeRetrieval, <span class="stringliteral">"Retrieval of focus mode successful"</span>);
<a name="l00054"></a>00054 _LIT(KSupportedFocusRanges, <span class="stringliteral">"Getting supported focus ranges"</span>);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 _LIT(KSupportedFocusTypes, <span class="stringliteral">"Getting the supported focus types"</span>);
<a name="l00057"></a>00057 _LIT(KFocusTypeSet, <span class="stringliteral">"Setting the focus type to auto"</span>);
<a name="l00058"></a>00058 _LIT(KFocusTypeRetrieval, <span class="stringliteral">"Retrieval of focus type successful"</span>);
<a name="l00059"></a>00059 _LIT(KFocusRangeAuto,  <span class="stringliteral">"Setting focus range to automatic"</span>);
<a name="l00060"></a>00060 _LIT(KFocusRangeRetrieval, <span class="stringliteral">"Retrieval of focus range successful"</span>);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 _LIT(KSupportedDriveModes, <span class="stringliteral">"Getting supported drive modes"</span>);
<a name="l00063"></a>00063 _LIT(KDriveModeSet, <span class="stringliteral">"Setting drive mode"</span>);
<a name="l00064"></a>00064 _LIT(KDriveModeRetrieval, <span class="stringliteral">"Getting the set drive mode"</span>);
<a name="l00065"></a>00065 _LIT(KSupportedBracketModes, <span class="stringliteral">"Getting supported bracket modes"</span>);
<a name="l00066"></a>00066 _LIT(KBracketModeRetrieval, <span class="stringliteral">"Getting the set bracket mode"</span>);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 _LIT(KSupportedSnapshotFormats, <span class="stringliteral">"Getting the supported formats for snapshot"</span>);
<a name="l00069"></a>00069 _LIT(KPrepareSnapshot, <span class="stringliteral">"Preparing the snapshot was successful"</span>);
<a name="l00070"></a>00070 _LIT(KPrepareSnapshotErr, <span class="stringliteral">"Prepare snapshot failed"</span>);
<a name="l00071"></a>00071 _LIT(KSnapshotFormat,<span class="stringliteral">"Set the snapshot format to  EFormatJpeg"</span>);
<a name="l00072"></a>00072 _LIT(KSnapshotFormatErr,<span class="stringliteral">"The format you are trying to set is not supported"</span>);
<a name="l00073"></a>00073 _LIT(KStartSnapshot, <span class="stringliteral">"Starting the snapshot successful"</span>);
<a name="l00074"></a>00074 _LIT(KStopSnapshot, <span class="stringliteral">"Snapshot stopped"</span>);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 _LIT(KViewFinderInactive, <span class="stringliteral">"View finder state inactive"</span>);
<a name="l00077"></a>00077 _LIT(KViewFinderPause , <span class="stringliteral">"Pausing the view finder successful"</span>);
<a name="l00078"></a>00078 _LIT(KViewFinderPauseErr, <span class="stringliteral">"Pausing the view finder failed"</span>);
<a name="l00079"></a>00079 _LIT(KViewFinderStatePaused,  <span class="stringliteral">"View finder state paused"</span>);
<a name="l00080"></a>00080 _LIT(KViewFinderResume, <span class="stringliteral">"Resuming view finder was successful"</span>);
<a name="l00081"></a>00081 _LIT(KViewFinderResumeErr, <span class="stringliteral">"Resuming view finder failed"</span>);
<a name="l00082"></a>00082 _LIT(KViewFinderStateActive, <span class="stringliteral">"View finder state active"</span>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 _LIT(KCreateHistogram, <span class="stringliteral">"Creating the non-DSA histogram was successful"</span>);
<a name="l00085"></a>00085 _LIT(KHistStart,<span class="stringliteral">"Start Histogram Successful"</span>);
<a name="l00086"></a>00086 _LIT(KHistStartErr,<span class="stringliteral">"Start Histogram failed"</span>);
<a name="l00087"></a>00087 _LIT(KHistStop,<span class="stringliteral">"Stopping the histogram successful"</span>);
<a name="l00088"></a>00088 _LIT(KHistStopErr,<span class="stringliteral">"Stopping histogram failed"</span>);
<a name="l00089"></a>00089 _LIT(KDestroyHistogram, <span class="stringliteral">"Destruction of histogram successful"</span>);
<a name="l00090"></a>00090 _LIT(KDestroyHistogramErr, <span class="stringliteral">"Destruction of histogram failed"</span>);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 _LIT(KCreateoverlay ,<span class="stringliteral">"Creating overlay successful"</span>);
<a name="l00093"></a>00093 _LIT(KCreateoverlayErr , <span class="stringliteral">"Creating overlay failed.Cannot proceed further"</span>);
<a name="l00094"></a>00094 _LIT(KOverLayMode,<span class="stringliteral">"Set the current mode to  EModeStillImage"</span>);
<a name="l00095"></a>00095 _LIT(KOverLayModeErr,<span class="stringliteral">"The mode you are trying to set is not supported"</span>);
<a name="l00096"></a>00096 _LIT(KCurrentTypeErr,<span class="stringliteral">"The type you are trying to set is not supported"</span>);
<a name="l00097"></a>00097 _LIT(KOverlayType,<span class="stringliteral">"Blending is set to per pixel basis"</span>);
<a name="l00098"></a>00098 _LIT(KSetoverlayBmp , <span class="stringliteral">"Setting the Overlay Bitmap successful"</span>);
<a name="l00099"></a>00099 _LIT(KSetoverlayBmpErr , <span class="stringliteral">"Setting the Overlay Bitmap failed"</span>);
<a name="l00100"></a>00100 _LIT(KGetoverlayBmp, <span class="stringliteral">"Getting Overlay Bitmap successful"</span>);
<a name="l00101"></a>00101 _LIT(KGetoverlayBmpErr, <span class="stringliteral">"Getting Overlay Bitmap failed"</span>);
<a name="l00102"></a>00102 _LIT(KGetoverlayParams , <span class="stringliteral">"Getting the Overlay Bitmap successful"</span>);
<a name="l00103"></a>00103 _LIT(KGetoverlayParamsErr , <span class="stringliteral">"Getting the Overlay Bitmap failed"</span>);
<a name="l00104"></a>00104 _LIT(KSetoverlayParams , <span class="stringliteral">"Setting Overlay Parameters successful"</span>);
<a name="l00105"></a>00105 _LIT(KSetoverlayParamsErr , <span class="stringliteral">"Setting Overlay Parameters failed"</span>);
<a name="l00106"></a>00106 _LIT(KGetAllOverlays, <span class="stringliteral">"Getting All Overlays successful"</span>);
<a name="l00107"></a>00107 _LIT(KGetAllOverlaysErr , <span class="stringliteral">"Getting All Overlays failed"</span>);
<a name="l00108"></a>00108 _LIT(KReleaseOverlay, <span class="stringliteral">"Releasing Overlay successful"</span>);
<a name="l00109"></a>00109 _LIT(KReleaseOverlayErr, <span class="stringliteral">"Releasing Overlay failed"</span>);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 _LIT(KGetAffectedSettings, <span class="stringliteral">"Getting the affected settings successful"</span>);
<a name="l00112"></a>00112 _LIT(KGetAffectedSettingsErr, <span class="stringliteral">"Getting the affected settings failed"</span>);
<a name="l00113"></a>00113 _LIT(KSupportedPresets, <span class="stringliteral">"Getting the supported presets"</span>);
<a name="l00114"></a>00114 _LIT(KEmptyArray, <span class="stringliteral">"Getting the presets failed. The array of Uids is empty"</span>);
<a name="l00115"></a>00115 _LIT(KSetBrightness, <span class="stringliteral">"Adjusting brightness to maximum value"</span>);
<a name="l00116"></a>00116 _LIT(KImageEffect, <span class="stringliteral">"Set monochrome effect"</span>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00123"></a><a class="code" href="class_c_camera_app_ui.html#6ecb1ead53a770f319772377235c7914">00123</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#6ecb1ead53a770f319772377235c7914">CCameraAppUi::ConstructL</a>()
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125     
<a name="l00126"></a>00126     CEikAppUi::ConstructL();
<a name="l00127"></a>00127         iAppView = <span class="keyword">new</span>(ELeave) <a class="code" href="class_c_camera_app_view.html">CCameraAppView</a>;
<a name="l00128"></a>00128         iAppView-&gt;<a class="code" href="class_c_camera_app_view.html#db2f32961e1f89398a99f1e98279f351">ConstructL</a>(ClientRect());
<a name="l00129"></a>00129         
<a name="l00130"></a>00130         AddToStackL(iAppView);
<a name="l00131"></a>00131         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,iCamera = CCamera::NewL(*<span class="keyword">this</span>,0,0));
<a name="l00132"></a>00132         <span class="keywordflow">if</span> (<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a> != KErrNone)
<a name="l00133"></a>00133                 {
<a name="l00134"></a>00134                 iEikonEnv-&gt;InfoMsg(KError);
<a name="l00135"></a>00135                 User::Leave(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>);
<a name="l00136"></a>00136                 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="comment">// Asynchronous function that performs any required initialization </span>
<a name="l00139"></a>00139         <span class="comment">// and reserves the camera for exclusive use.</span>
<a name="l00140"></a>00140         iCamera-&gt;Reserve();
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143 
<a name="l00147"></a><a class="code" href="class_c_camera_app_ui.html#27256e7f88d08f1050b44ad5fd8636e2">00147</a> <a class="code" href="class_c_camera_app_ui.html#27256e7f88d08f1050b44ad5fd8636e2">CCameraAppUi::~CCameraAppUi</a>()
<a name="l00148"></a>00148         {
<a name="l00149"></a>00149         <span class="keywordflow">if</span> (iCamera!=NULL)
<a name="l00150"></a>00150                 iCamera-&gt;Release();
<a name="l00151"></a>00151         <span class="keyword">delete</span> iCamera;
<a name="l00152"></a>00152                 
<a name="l00153"></a>00153         <span class="keywordflow">if</span> (iAppView)
<a name="l00154"></a>00154                 {
<a name="l00155"></a>00155                 RemoveFromStack(iAppView);
<a name="l00156"></a>00156                 <span class="keyword">delete</span> iAppView;
<a name="l00157"></a>00157                 }
<a name="l00158"></a>00158         ifsSession.Close();
<a name="l00159"></a>00159         }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00166"></a>00166 <span class="keywordtype">void</span> CCameraAppUi::HandleCommandL(TInt aCommand)
<a name="l00167"></a>00167         {
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="keywordflow">switch</span> (aCommand)
<a name="l00170"></a>00170                 {
<a name="l00171"></a>00171         <span class="keywordflow">case</span> ETCamCmdPowerOn:
<a name="l00172"></a>00172                 iCamera-&gt;PowerOn();
<a name="l00173"></a>00173                 <span class="keywordflow">break</span>;
<a name="l00174"></a>00174         <span class="keywordflow">case</span> ETCamCmdPowerOff:
<a name="l00175"></a>00175                 iCamera-&gt;PowerOff();
<a name="l00176"></a>00176                 <span class="keywordflow">break</span>;
<a name="l00177"></a>00177         <span class="keywordflow">case</span> ETCamCmdViewFinder:
<a name="l00178"></a>00178                 <a class="code" href="class_c_camera_app_ui.html#97ada137f3d37bbeadd61579d74e3d5a">ViewFinderL</a>();
<a name="l00179"></a>00179                 <span class="keywordflow">break</span>;
<a name="l00180"></a>00180         <span class="keywordflow">case</span> ETCamCmdCaptureImage:
<a name="l00181"></a>00181                 <a class="code" href="class_c_camera_app_ui.html#9301b0f677dd76337ffbe61f4754de70">CaptureImageL</a>();
<a name="l00182"></a>00182                 <span class="keywordflow">break</span>;
<a name="l00183"></a>00183         <span class="keywordflow">case</span> ETCamCmdCaptureVideo:
<a name="l00184"></a>00184                 <a class="code" href="class_c_camera_app_ui.html#bc71df97c59cf25bca9fb6d7610be985">CaptureVideoL</a>();
<a name="l00185"></a>00185                 <span class="keywordflow">break</span>;
<a name="l00186"></a>00186         <span class="keywordflow">case</span> ETCamCmdIncBrightness:
<a name="l00187"></a>00187                 iCamera-&gt;SetBrightnessL(iCamera-&gt;Brightness() + 10);
<a name="l00188"></a>00188                 <span class="keywordflow">break</span>;
<a name="l00189"></a>00189         <span class="keywordflow">case</span> ETCamCmdIncContrast:
<a name="l00190"></a>00190                 iCamera-&gt;SetContrastL(iCamera-&gt;Contrast() + 10);
<a name="l00191"></a>00191                 <span class="keywordflow">break</span>;
<a name="l00192"></a>00192         <span class="keywordflow">case</span> ETCamCmdDecBrightness:
<a name="l00193"></a>00193                 iCamera-&gt;SetBrightnessL(iCamera-&gt;Brightness() - 10);
<a name="l00194"></a>00194                 <span class="keywordflow">break</span>;
<a name="l00195"></a>00195         <span class="keywordflow">case</span> ETCamCmdDecContrast:
<a name="l00196"></a>00196                 iCamera-&gt;SetContrastL(iCamera-&gt;Contrast() - 10);
<a name="l00197"></a>00197                 <span class="keywordflow">break</span>;
<a name="l00198"></a>00198         <span class="keywordflow">case</span> ETCamCmdAdvancedCamFeatures:
<a name="l00199"></a>00199                 <a class="code" href="class_c_camera_app_ui.html#64214eac7c10825293a9310c66a6c781">AdvancedCamFeaturesL</a>(); 
<a name="l00200"></a>00200                 <span class="keywordflow">break</span>;  
<a name="l00201"></a>00201         <span class="keywordflow">case</span> ETCamCmdSnapShot:
<a name="l00202"></a>00202                 <a class="code" href="class_c_camera_app_ui.html#7f41b74420d65d4ac69cc10d473c8d47">SnapShotL</a>();
<a name="l00203"></a>00203                 <span class="keywordflow">break</span>;  
<a name="l00204"></a>00204         <span class="keywordflow">case</span> ETCamCmdDirectViewFinder:
<a name="l00205"></a>00205                 <a class="code" href="class_c_camera_app_ui.html#8e0538e1ba234ca18167e69b57ade05c">DirectViewFinderL</a>();    
<a name="l00206"></a>00206                 <span class="keywordflow">break</span>;  
<a name="l00207"></a>00207         <span class="keywordflow">case</span> ETCamCmdHistogram:
<a name="l00208"></a>00208                 <a class="code" href="class_c_camera_app_ui.html#4de9323821b8c31ec843c50f1c144e6a">HistogramL</a>();   
<a name="l00209"></a>00209                 <span class="keywordflow">break</span>;  
<a name="l00210"></a>00210         <span class="keywordflow">case</span> ETCamCmdOverLay:
<a name="l00211"></a>00211                 <a class="code" href="class_c_camera_app_ui.html#2278865a43dad9483da33e886ee04011">OverLayL</a>();     
<a name="l00212"></a>00212                 <span class="keywordflow">break</span>;  
<a name="l00213"></a>00213         <span class="keywordflow">case</span> ETCamCmdPreset:
<a name="l00214"></a>00214                 <a class="code" href="class_c_camera_app_ui.html#2315d6c9b627e6d2abc0568d8e40bcd0">PresetL</a>();      
<a name="l00215"></a>00215                 <span class="keywordflow">break</span>;  
<a name="l00216"></a>00216         <span class="keywordflow">case</span> ETCamCmdImageProcessing:
<a name="l00217"></a>00217                 <a class="code" href="class_c_camera_app_ui.html#6f7cc6d4b34efada215a7ebe1a9e73d8">ImageProcessingL</a>();             
<a name="l00218"></a>00218                 <span class="keywordflow">break</span>;  
<a name="l00219"></a>00219         <span class="keywordflow">case</span> EEikCmdExit:
<a name="l00220"></a>00220                 Exit();
<a name="l00221"></a>00221                 <span class="keywordflow">break</span>;
<a name="l00222"></a>00222                 }
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224 
<a name="l00231"></a><a class="code" href="class_c_camera_app_ui.html#97ada137f3d37bbeadd61579d74e3d5a">00231</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#97ada137f3d37bbeadd61579d74e3d5a">CCameraAppUi::ViewFinderL</a>()
<a name="l00232"></a>00232         {
<a name="l00233"></a>00233         TSize imageSize;
<a name="l00234"></a>00234         iCamera-&gt;EnumerateCaptureSizes(imageSize,1,CCamera::EFormatFbsBitmapColor16M);
<a name="l00235"></a>00235         <span class="keyword">const</span> TPoint pos = iAppView-&gt;<a class="code" href="class_c_camera_app_view.html#0ff9bb3025f4215d93d61253a7829891">DrawBorders</a>(imageSize);
<a name="l00236"></a>00236         
<a name="l00237"></a>00237         TRect screenRect(pos,imageSize);
<a name="l00238"></a>00238         TRect clipRect;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (!iCamera-&gt;ViewFinderActive())
<a name="l00241"></a>00241                 {
<a name="l00242"></a>00242                 iCamera-&gt;StartViewFinderDirectL(iCoeEnv-&gt;WsSession(),*iCoeEnv-&gt;ScreenDevice(),*iAppView-&gt;DrawableWindow(),screenRect,clipRect);         
<a name="l00243"></a>00243                 }
<a name="l00244"></a>00244         <span class="keywordflow">else</span>
<a name="l00245"></a>00245                 {
<a name="l00246"></a>00246                 iCamera-&gt;StopViewFinder();
<a name="l00247"></a>00247                 }
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249 
<a name="l00258"></a><a class="code" href="class_c_camera_app_ui.html#9301b0f677dd76337ffbe61f4754de70">00258</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#9301b0f677dd76337ffbe61f4754de70">CCameraAppUi::CaptureImageL</a>()
<a name="l00259"></a>00259         {
<a name="l00260"></a>00260         TSize imageSize;
<a name="l00261"></a>00261         iCamera-&gt;EnumerateCaptureSizes(imageSize,1,CCamera::EFormatFbsBitmapColor16M);
<a name="l00262"></a>00262         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, iCamera-&gt;PrepareImageCaptureL(CCamera::EFormatFbsBitmapColor16M,1));
<a name="l00263"></a>00263         <span class="keywordflow">if</span>(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>!= KErrNone)
<a name="l00264"></a>00264                 {
<a name="l00265"></a>00265                 InfoMessage(KPrepareImageCaptureErr);
<a name="l00266"></a>00266                 User::Leave(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>);     
<a name="l00267"></a>00267                 }
<a name="l00268"></a>00268         
<a name="l00269"></a>00269         iCamera-&gt;CaptureImage();
<a name="l00270"></a>00270         
<a name="l00271"></a>00271         <span class="comment">// Displays the captured image size</span>
<a name="l00272"></a>00272         TBuf&lt;100&gt; buffer;
<a name="l00273"></a>00273     buffer.Format(KImageSize,imageSize.iWidth,imageSize.iHeight);
<a name="l00274"></a>00274         InfoMessage(buffer);
<a name="l00275"></a>00275                 
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277 
<a name="l00282"></a><a class="code" href="class_c_camera_app_ui.html#bc71df97c59cf25bca9fb6d7610be985">00282</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#bc71df97c59cf25bca9fb6d7610be985">CCameraAppUi::CaptureVideoL</a>()
<a name="l00283"></a>00283         {
<a name="l00284"></a>00284         TSize frameSize;
<a name="l00285"></a>00285         TReal32 frameRate = 0;
<a name="l00286"></a>00286         iCamera-&gt;EnumerateVideoFrameSizes(frameSize,0,CCamera::EFormatFbsBitmapColor16M);
<a name="l00287"></a>00287         iCamera-&gt;EnumerateVideoFrameRates(frameRate,0,CCamera::EFormatFbsBitmapColor16M,0);
<a name="l00288"></a>00288         
<a name="l00289"></a>00289         <span class="keywordflow">if</span> (!iCamera-&gt;VideoCaptureActive())
<a name="l00290"></a>00290                 {
<a name="l00291"></a>00291                 TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, iCamera-&gt;PrepareVideoCaptureL(CCamera::EFormatFbsBitmapColor16M,0,0,2,1));
<a name="l00292"></a>00292                 <span class="keywordflow">if</span>(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>!= KErrNone)
<a name="l00293"></a>00293                         {
<a name="l00294"></a>00294                         InfoMessage(KPrepareVideoCaptureErr);
<a name="l00295"></a>00295                         User::Leave(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>);     
<a name="l00296"></a>00296                         }
<a name="l00297"></a>00297                 
<a name="l00298"></a>00298                 iCamera-&gt;StartVideoCapture();
<a name="l00299"></a>00299                 
<a name="l00300"></a>00300                 <span class="comment">// Displays the captured video size and rate of capture</span>
<a name="l00301"></a>00301                 TBuf&lt;100&gt; videoBuf;
<a name="l00302"></a>00302         videoBuf.Format(KVideoCapture,frameRate,frameSize.iWidth,frameSize.iHeight);
<a name="l00303"></a>00303                 InfoMessage(videoBuf);
<a name="l00304"></a>00304                 }
<a name="l00305"></a>00305         <span class="keywordflow">else</span>
<a name="l00306"></a>00306                 {
<a name="l00307"></a>00307                 iCamera-&gt;StopVideoCapture();
<a name="l00308"></a>00308                 }       
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310 
<a name="l00332"></a><a class="code" href="class_c_camera_app_ui.html#9798077208eeb14e6dc598169cf341b4">00332</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#9798077208eeb14e6dc598169cf341b4">CCameraAppUi::HandleEvent</a>(<span class="keyword">const</span> TECAMEvent&amp; <span class="comment">/*aEvent*/</span>)
<a name="l00333"></a>00333         {
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335         
<a name="l00336"></a>00336 
<a name="l00342"></a><a class="code" href="class_c_camera_app_ui.html#1e5c521b2591bc5b1a6e32c95aa33561">00342</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#1e5c521b2591bc5b1a6e32c95aa33561">CCameraAppUi::ViewFinderReady</a>(MCameraBuffer&amp; <span class="comment">/*aCameraBuffer*/</span>,TInt <span class="comment">/*aError*/</span>)
<a name="l00343"></a>00343         {
<a name="l00344"></a>00344         
<a name="l00345"></a>00345         }
<a name="l00346"></a>00346 
<a name="l00354"></a><a class="code" href="class_c_camera_app_ui.html#5e3cdca0a947db30b144f064e706b2c1">00354</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#5e3cdca0a947db30b144f064e706b2c1">CCameraAppUi::ImageBufferReady</a>(MCameraBuffer&amp; aCameraBuffer,TInt aError)
<a name="l00355"></a>00355         {
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (iCamera-&gt;ViewFinderActive())
<a name="l00357"></a>00357                 {       
<a name="l00358"></a>00358                 iCamera-&gt;StopViewFinder();
<a name="l00359"></a>00359                 }
<a name="l00360"></a>00360         TBuf&lt;KMaxErrLength&gt; msgBuffer;
<a name="l00361"></a>00361         <span class="keywordflow">if</span>(aError)
<a name="l00362"></a>00362                 {
<a name="l00363"></a>00363                 msgBuffer.Format(KErrorFormat,aError,&amp;KErrMessage);
<a name="l00364"></a>00364                 iEikonEnv-&gt;InfoMsg(msgBuffer);
<a name="l00365"></a>00365                 <span class="keywordflow">return</span>;
<a name="l00366"></a>00366                 }
<a name="l00367"></a>00367                 TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,iAppView-&gt;<a class="code" href="class_c_camera_app_view.html#e0592f456fef0fe229660da7454d394f">DrawImage</a>(&amp;aCameraBuffer.BitmapL(0)));
<a name="l00368"></a>00368                 aCameraBuffer.Release();
<a name="l00369"></a>00369         <span class="keywordflow">if</span> (<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>)
<a name="l00370"></a>00370                 {
<a name="l00371"></a>00371                 msgBuffer.Format(KErrorFormat,aError,&amp;KErrMessage);
<a name="l00372"></a>00372                 iEikonEnv-&gt;InfoMsg(msgBuffer);
<a name="l00373"></a>00373                 }
<a name="l00374"></a>00374                 
<a name="l00375"></a>00375         }
<a name="l00387"></a><a class="code" href="class_c_camera_app_ui.html#80c7753066e521d44420ca5acc5943f2">00387</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#80c7753066e521d44420ca5acc5943f2">CCameraAppUi::VideoBufferReady</a>(MCameraBuffer&amp; aCameraBuffer,TInt aError)
<a name="l00388"></a>00388         {
<a name="l00389"></a>00389         TBuf&lt;KMaxErrLength&gt; msgBuffer;
<a name="l00390"></a>00390         _LIT(KErrMessage,<span class="stringliteral">"CCameraAppUi::FrameBufferReady"</span>);
<a name="l00391"></a>00391         <span class="keywordflow">if</span> (aError)
<a name="l00392"></a>00392                 {
<a name="l00393"></a>00393                 msgBuffer.Format(KErrorFormat,aError,&amp;KErrMessage);
<a name="l00394"></a>00394                 iEikonEnv-&gt;InfoMsg(msgBuffer);
<a name="l00395"></a>00395                 <span class="keywordflow">return</span>;
<a name="l00396"></a>00396                 }
<a name="l00397"></a>00397         TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,iAppView-&gt;<a class="code" href="class_c_camera_app_view.html#e0592f456fef0fe229660da7454d394f">DrawImage</a>(&amp;aCameraBuffer.BitmapL(0)));
<a name="l00398"></a>00398         aCameraBuffer.Release();
<a name="l00399"></a>00399         <span class="keywordflow">if</span> (<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>)
<a name="l00400"></a>00400                 {
<a name="l00401"></a>00401                 msgBuffer.Format(KErrorFormat,<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,&amp;KErrMessage);
<a name="l00402"></a>00402                 iEikonEnv-&gt;InfoMsg(msgBuffer);
<a name="l00403"></a>00403                 }       
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405 
<a name="l00415"></a><a class="code" href="class_c_camera_app_ui.html#64214eac7c10825293a9310c66a6c781">00415</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#64214eac7c10825293a9310c66a6c781">CCameraAppUi::AdvancedCamFeaturesL</a>()
<a name="l00416"></a>00416         {
<a name="l00417"></a>00417         CCamera::CCameraAdvancedSettings* settings = NULL;
<a name="l00418"></a>00418         settings = CCamera::CCameraAdvancedSettings::NewL(*iCamera);
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (settings == NULL)
<a name="l00420"></a>00420                 {
<a name="l00421"></a>00421                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00422"></a>00422                 <span class="keywordflow">return</span>;
<a name="l00423"></a>00423                 }
<a name="l00424"></a>00424         CleanupStack::PushL(settings);
<a name="l00425"></a>00425         
<a name="l00426"></a>00426         <span class="comment">// Assigns the focus mode to be set     </span>
<a name="l00427"></a>00427         CCamera::CCameraAdvancedSettings::TFocusMode focusMode = CCamera::CCameraAdvancedSettings::EFocusModeFixed;
<a name="l00428"></a>00428         
<a name="l00429"></a>00429         <span class="comment">// Gets the supported modes</span>
<a name="l00430"></a>00430         TInt suppFocusModes = settings-&gt;SupportedFocusModes();
<a name="l00431"></a>00431         InfoMessage(KSupportedFocusModes);
<a name="l00432"></a>00432         
<a name="l00433"></a>00433         <span class="comment">// Checks if the focus mode is supported before setting it.</span>
<a name="l00434"></a>00434         <span class="keywordflow">if</span> (focusMode &amp; suppFocusModes)
<a name="l00435"></a>00435             {
<a name="l00436"></a>00436                 <span class="comment">// Sets the focus mode if it is supported</span>
<a name="l00437"></a>00437             settings-&gt;SetFocusMode(focusMode);
<a name="l00438"></a>00438             InfoMessage(KFocusModeSet);         
<a name="l00439"></a>00439             }
<a name="l00440"></a>00440         <span class="keywordflow">else</span>
<a name="l00441"></a>00441             {
<a name="l00442"></a>00442             InfoMessage(KNotSupported);
<a name="l00443"></a>00443                 <span class="comment">// Set auto mode since other mode is not supported</span>
<a name="l00444"></a>00444                 CCamera::CCameraAdvancedSettings::TFocusMode focusMode = CCamera::CCameraAdvancedSettings::EFocusModeAuto;
<a name="l00445"></a>00445                 settings-&gt;SetFocusMode(focusMode);   
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447             
<a name="l00448"></a>00448         <span class="comment">// Retrieves the set focus mode </span>
<a name="l00449"></a>00449         focusMode = settings-&gt;FocusMode();
<a name="l00450"></a>00450         InfoMessage(KFocusModeRetrieval);   
<a name="l00451"></a>00451         
<a name="l00452"></a>00452         <span class="comment">// Assigns the focus range to auto and checks if it is supported</span>
<a name="l00453"></a>00453         CCamera::CCameraAdvancedSettings::TFocusRange focusRange = CCamera::CCameraAdvancedSettings::EFocusRangeHyperfocal;
<a name="l00454"></a>00454             
<a name="l00455"></a>00455         <span class="comment">// Gets the supported ranges            </span>
<a name="l00456"></a>00456         TInt suppRanges = settings-&gt;SupportedFocusRanges();
<a name="l00457"></a>00457         InfoMessage(KSupportedFocusRanges);
<a name="l00458"></a>00458         
<a name="l00459"></a>00459         <span class="comment">// Checks if the focus range is supported before setting it.</span>
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (focusRange &amp; suppRanges) 
<a name="l00461"></a>00461             {
<a name="l00462"></a>00462                 <span class="comment">// Sets the focus range if it is supported</span>
<a name="l00463"></a>00463             settings-&gt;SetFocusRange(focusRange);
<a name="l00464"></a>00464             InfoMessage(KFocusRangeAuto);
<a name="l00465"></a>00465             <span class="comment">// Gets the set focus range </span>
<a name="l00466"></a>00466             focusRange = settings-&gt;FocusRange();
<a name="l00467"></a>00467                 InfoMessage(KFocusRangeRetrieval);              
<a name="l00468"></a>00468             }
<a name="l00469"></a>00469         <span class="keywordflow">else</span>
<a name="l00470"></a>00470             {
<a name="l00471"></a>00471             InfoMessage(KNotSupported); 
<a name="l00472"></a>00472             }
<a name="l00473"></a>00473                 
<a name="l00474"></a>00474         <span class="comment">// Assigns the focus type to EAutoFocusTypeOff</span>
<a name="l00475"></a>00475         CCamera::CCameraAdvancedSettings::TAutoFocusType focusType = CCamera::CCameraAdvancedSettings::EAutoFocusTypeOff;
<a name="l00476"></a>00476         
<a name="l00477"></a>00477         <span class="comment">// Gets the supported focus types</span>
<a name="l00478"></a>00478         TInt suppFocusTypes = settings-&gt;SupportedAutoFocusTypes();
<a name="l00479"></a>00479         InfoMessage(KSupportedFocusTypes);
<a name="l00480"></a>00480         
<a name="l00481"></a>00481         <span class="comment">// Checks if the focus type is supported before setting it.</span>
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (focusType &amp; suppFocusTypes)
<a name="l00483"></a>00483             {
<a name="l00484"></a>00484             <span class="comment">// Sets the focus type if it is supported</span>
<a name="l00485"></a>00485             settings-&gt;SetAutoFocusType(focusType);
<a name="l00486"></a>00486             InfoMessage(KFocusTypeSet);                 
<a name="l00487"></a>00487             }
<a name="l00488"></a>00488         <span class="keywordflow">else</span>
<a name="l00489"></a>00489             {
<a name="l00490"></a>00490             InfoMessage(KNotSupported);
<a name="l00491"></a>00491                 <span class="comment">// Sets another type if the above type is not supported</span>
<a name="l00492"></a>00492                 CCamera::CCameraAdvancedSettings::TAutoFocusType autoFocusType = CCamera::CCameraAdvancedSettings::EAutoFocusTypeSingle;
<a name="l00493"></a>00493                 settings-&gt;SetAutoFocusType(autoFocusType);
<a name="l00494"></a>00494             
<a name="l00495"></a>00495             }
<a name="l00496"></a>00496             <span class="comment">// Retrieves the set focus mode     </span>
<a name="l00497"></a>00497             focusType = settings-&gt;AutoFocusType();
<a name="l00498"></a>00498                 InfoMessage(KFocusTypeRetrieval);  
<a name="l00499"></a>00499                 
<a name="l00500"></a>00500         <span class="comment">// Assigns the drive mode to the value you want to check        </span>
<a name="l00501"></a>00501         CCamera::CCameraAdvancedSettings::TDriveMode driveMode = CCamera::CCameraAdvancedSettings::EDriveModeSingleShot;
<a name="l00502"></a>00502         
<a name="l00503"></a>00503         <span class="comment">// Gets the supported drive modes</span>
<a name="l00504"></a>00504         TInt suppDriveModes = settings-&gt;SupportedDriveModes();
<a name="l00505"></a>00505         InfoMessage(KSupportedDriveModes);
<a name="l00506"></a>00506         
<a name="l00507"></a>00507         <span class="comment">// Checks if the drive mode is supported before setting it.</span>
<a name="l00508"></a>00508         <span class="keywordflow">if</span> (driveMode &amp; suppDriveModes) 
<a name="l00509"></a>00509             {
<a name="l00510"></a>00510                 <span class="comment">// Sets the drive mode.</span>
<a name="l00511"></a>00511             settings-&gt;SetDriveMode(driveMode);
<a name="l00512"></a>00512             InfoMessage(KDriveModeSet);         
<a name="l00513"></a>00513             }
<a name="l00514"></a>00514         <span class="keywordflow">else</span>
<a name="l00515"></a>00515             {
<a name="l00516"></a>00516             InfoMessage(KNotSupported);
<a name="l00517"></a>00517                 <span class="comment">// Sets auto mode if other type is not supported</span>
<a name="l00518"></a>00518                 CCamera::CCameraAdvancedSettings::TDriveMode defaultDriveMode = CCamera::CCameraAdvancedSettings::EDriveModeAuto;
<a name="l00519"></a>00519                 settings-&gt;SetDriveMode(defaultDriveMode);       
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521             
<a name="l00522"></a>00522         <span class="comment">// Retrieves the set drive mode </span>
<a name="l00523"></a>00523         driveMode = settings-&gt;DriveMode();
<a name="l00524"></a>00524         InfoMessage(KDriveModeRetrieval);  
<a name="l00525"></a>00525         
<a name="l00526"></a>00526         <span class="comment">// Assigns bracket mode to EBracketMode3Image</span>
<a name="l00527"></a>00527         CCamera::CCameraAdvancedSettings::TBracketMode bracketMode = CCamera::CCameraAdvancedSettings::EBracketMode3Image;
<a name="l00528"></a>00528         
<a name="l00529"></a>00529         <span class="comment">// Gets the supported bracket modes</span>
<a name="l00530"></a>00530         TInt suppBracketModes = settings-&gt;SupportedBracketModes();
<a name="l00531"></a>00531         InfoMessage(KSupportedBracketModes);
<a name="l00532"></a>00532         
<a name="l00533"></a>00533         <span class="comment">// Checks if the bracket mode is supported before setting it.</span>
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (bracketMode &amp; suppBracketModes) 
<a name="l00535"></a>00535             {
<a name="l00536"></a>00536             settings-&gt;SetBracketMode(bracketMode);      
<a name="l00537"></a>00537                 <span class="comment">// Retrieve the set bracket mode        </span>
<a name="l00538"></a>00538                 bracketMode = settings-&gt;BracketMode();  
<a name="l00539"></a>00539             }
<a name="l00540"></a>00540             
<a name="l00541"></a>00541         <span class="keywordflow">else</span>
<a name="l00542"></a>00542                 {
<a name="l00543"></a>00543                 InfoMessage(KNotSupported);
<a name="l00544"></a>00544                 <span class="comment">// Sets other mode since the previously set mode is not supported</span>
<a name="l00545"></a>00545                 CCamera::CCameraAdvancedSettings::TBracketMode bracketMode = CCamera::CCameraAdvancedSettings::EBracketModeOff;
<a name="l00546"></a>00546                 settings-&gt;SetBracketMode(bracketMode);
<a name="l00547"></a>00547                 bracketMode = settings-&gt;BracketMode(); 
<a name="l00548"></a>00548                 InfoMessage(KBracketModeRetrieval);
<a name="l00549"></a>00549                 }
<a name="l00550"></a>00550                 
<a name="l00551"></a>00551         TBool redEye = settings-&gt;RedEyeReduceOn();
<a name="l00552"></a>00552         <span class="comment">// If red eye reduction is turned off, turn it on</span>
<a name="l00553"></a>00553         <span class="keywordflow">if</span>(redEye == EFalse)
<a name="l00554"></a>00554                 {
<a name="l00555"></a>00555                 settings-&gt;SetRedEyeReduceOn(ETrue);     
<a name="l00556"></a>00556                 }
<a name="l00557"></a>00557         
<a name="l00558"></a>00558         CleanupStack::PopAndDestroy(settings);
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560 
<a name="l00568"></a><a class="code" href="class_c_camera_app_ui.html#7f41b74420d65d4ac69cc10d473c8d47">00568</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#7f41b74420d65d4ac69cc10d473c8d47">CCameraAppUi::SnapShotL</a>()
<a name="l00569"></a>00569         {
<a name="l00570"></a>00570         CCamera::CCameraSnapshot* snap = NULL;
<a name="l00571"></a>00571         TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, snap  = CCamera::CCameraSnapshot::NewL(*iCamera)); 
<a name="l00572"></a>00572         <span class="keywordflow">if</span> (snap == NULL)
<a name="l00573"></a>00573                 {
<a name="l00574"></a>00574                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00575"></a>00575                 <span class="keywordflow">return</span>;
<a name="l00576"></a>00576                 }
<a name="l00577"></a>00577            
<a name="l00578"></a>00578     CleanupStack::PushL(snap);          
<a name="l00579"></a>00579     <span class="comment">// Gets the list of camera formats for which the </span>
<a name="l00580"></a>00580     <span class="comment">// ECam Server supports snapshots.</span>
<a name="l00581"></a>00581         TUint suppFormats = snap-&gt;SupportedFormats();
<a name="l00582"></a>00582         InfoMessage(KSupportedSnapshotFormats); 
<a name="l00583"></a>00583         
<a name="l00584"></a>00584         CCamera::TFormat format = CCamera::EFormatJpeg;
<a name="l00585"></a>00585         <span class="keywordflow">if</span>(suppFormats &amp; format)
<a name="l00586"></a>00586                 {
<a name="l00587"></a>00587                 InfoMessage(KSnapshotFormat);
<a name="l00588"></a>00588                 }
<a name="l00589"></a>00589         <span class="keywordflow">else</span>
<a name="l00590"></a>00590                 {
<a name="l00591"></a>00591                 InfoMessage(KSnapshotFormatErr);
<a name="l00592"></a>00592                 User::Leave(KErrNotSupported);
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594                 
<a name="l00595"></a>00595         TSize sShotSize(90,50);
<a name="l00596"></a>00596         TRgb bgrndColor(100,100,100);
<a name="l00597"></a>00597     TBool aspectRatio = ETrue;
<a name="l00598"></a>00598     TPoint orgPos(2,2);
<a name="l00599"></a>00599      
<a name="l00600"></a>00600     <span class="comment">// Sets the properties of the snapshot data including </span>
<a name="l00601"></a>00601     <span class="comment">// background colour and the position of the snapshot  </span>
<a name="l00602"></a>00602     TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,snap-&gt;PrepareSnapshotL(format, orgPos, sShotSize, bgrndColor,aspectRatio));
<a name="l00603"></a>00603     <span class="keywordflow">if</span>(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>!= KErrNone)
<a name="l00604"></a>00604                 {
<a name="l00605"></a>00605                 InfoMessage(KPrepareSnapshotErr);
<a name="l00606"></a>00606                 User::Leave(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>);     
<a name="l00607"></a>00607                 }
<a name="l00608"></a>00608                 
<a name="l00609"></a>00609     InfoMessage(KPrepareSnapshot);
<a name="l00610"></a>00610         
<a name="l00611"></a>00611         TBool isActive = EFalse;
<a name="l00612"></a>00612         isActive = User::LeaveIfError(snap-&gt;IsSnapshotActive());
<a name="l00613"></a>00613     User::LeaveIfError(isActive);
<a name="l00614"></a>00614     
<a name="l00615"></a>00615     <span class="comment">// A callback to HandleEvent() will occur when the snapshot data </span>
<a name="l00616"></a>00616     <span class="comment">// is ready to be retrieved.</span>
<a name="l00617"></a>00617     <span class="comment">// On success eventUid in HandleEvent() should have the value KUidECamEventCameraSnapshot</span>
<a name="l00618"></a>00618         snap-&gt;StartSnapshot();
<a name="l00619"></a>00619         InfoMessage(KStartSnapshot);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621     <span class="comment">// Deactivates the snapshot feature if it is active</span>
<a name="l00622"></a>00622     snap-&gt;StopSnapshot();
<a name="l00623"></a>00623     InfoMessage(KStopSnapshot);
<a name="l00624"></a>00624         CleanupStack::PopAndDestroy(snap);                      
<a name="l00625"></a>00625         }                               
<a name="l00626"></a>00626 
<a name="l00631"></a><a class="code" href="class_c_camera_app_ui.html#8e0538e1ba234ca18167e69b57ade05c">00631</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#8e0538e1ba234ca18167e69b57ade05c">CCameraAppUi::DirectViewFinderL</a>()
<a name="l00632"></a>00632         {
<a name="l00633"></a>00633         CCamera::CCameraDirectViewFinder* directviewfinder = NULL;
<a name="l00634"></a>00634         TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, directviewfinder  = CCamera::CCameraDirectViewFinder::NewL(*iCamera));     
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (directviewfinder == NULL)
<a name="l00636"></a>00636                 {
<a name="l00637"></a>00637                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00638"></a>00638                 <span class="keywordflow">return</span>;
<a name="l00639"></a>00639                 }
<a name="l00640"></a>00640         
<a name="l00641"></a>00641         CleanupStack::PushL(directviewfinder);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">// Gets the default viewfinder state</span>
<a name="l00644"></a>00644         directviewfinder-&gt;ViewFinderState();
<a name="l00645"></a>00645         InfoMessage(KViewFinderInactive);       
<a name="l00646"></a>00646         
<a name="l00647"></a>00647         <span class="comment">// Assumption is that meanwhile direct viewfinder has been started. This would be done by calling CCamera::StartViewFinderDirectL(). </span>
<a name="l00648"></a>00648         <span class="comment">// This function starts the direct viewfinder and hence changes the state to active. </span>
<a name="l00649"></a>00649         <span class="comment">// Also performs initial boundary checking that 'viewfinder remains inactive before its called'. So, the vfstate changes to active.</span>
<a name="l00650"></a>00650         <span class="comment">// The next step is to pause the direct viewfinder</span>
<a name="l00651"></a>00651         
<a name="l00652"></a>00652         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, directviewfinder-&gt;PauseViewFinderDirectL());
<a name="l00653"></a>00653         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KViewFinderPause, KViewFinderPauseErr);      
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         directviewfinder-&gt;ViewFinderState();
<a name="l00656"></a>00656         InfoMessage(KViewFinderStatePaused);    
<a name="l00657"></a>00657         
<a name="l00658"></a>00658         <span class="comment">// The next step is to resume the direct viewfinder</span>
<a name="l00659"></a>00659         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, directviewfinder-&gt;ResumeViewFinderDirectL());
<a name="l00660"></a>00660         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KViewFinderResume, KViewFinderResumeErr);    
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         directviewfinder-&gt;ViewFinderState();
<a name="l00663"></a>00663         InfoMessage(KViewFinderStateActive);    
<a name="l00664"></a>00664         
<a name="l00665"></a>00665         CleanupStack::PopAndDestroy(directviewfinder);
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667 
<a name="l00676"></a><a class="code" href="class_c_camera_app_ui.html#4de9323821b8c31ec843c50f1c144e6a">00676</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#4de9323821b8c31ec843c50f1c144e6a">CCameraAppUi::HistogramL</a>()
<a name="l00677"></a>00677         {
<a name="l00678"></a>00678         CCamera::CCameraHistogram* hist = NULL;
<a name="l00679"></a>00679         
<a name="l00680"></a>00680         TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, hist = CCamera::CCameraHistogram::NewL(*iCamera));
<a name="l00681"></a>00681         <span class="keywordflow">if</span> (hist == NULL)
<a name="l00682"></a>00682                 {
<a name="l00683"></a>00683                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00684"></a>00684                 <span class="keywordflow">return</span>;
<a name="l00685"></a>00685                 }
<a name="l00686"></a>00686         CleanupStack::PushL(hist);
<a name="l00687"></a>00687         
<a name="l00688"></a>00688         <span class="comment">// Gets the supported set of values</span>
<a name="l00689"></a>00689         TUint32 suppHists = hist-&gt;SupportedHistograms();
<a name="l00690"></a>00690         
<a name="l00691"></a>00691         <span class="comment">// The array should not be empty </span>
<a name="l00692"></a>00692         <span class="keywordflow">if</span> (suppHists == 0)
<a name="l00693"></a>00693                 {
<a name="l00694"></a>00694                 User::Leave(KErrNotSupported);
<a name="l00695"></a>00695                 }
<a name="l00696"></a>00696                 
<a name="l00697"></a>00697         <span class="comment">// Assigns the histogram type to ELuminance     </span>
<a name="l00698"></a>00698         CCamera::CCameraHistogram::THistogramType histType = CCamera::CCameraHistogram::ELuminance;
<a name="l00699"></a>00699                 
<a name="l00700"></a>00700         <span class="comment">// Checks if the histogram type is supported before setting it.</span>
<a name="l00701"></a>00701         <span class="keywordflow">if</span> (suppHists &amp; histType)
<a name="l00702"></a>00702             {
<a name="l00703"></a>00703                 <span class="comment">// Prepare Non-DSA based histogram</span>
<a name="l00704"></a>00704                 TUint histhandle = 0;
<a name="l00705"></a>00705                 
<a name="l00706"></a>00706                 TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, histhandle = hist-&gt;PrepareHistogramL(CCamera::CCameraHistogram::ELuminance));
<a name="l00707"></a>00707                 <span class="keywordflow">if</span>(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a> != KErrNone)
<a name="l00708"></a>00708                         {
<a name="l00709"></a>00709                         User::Leave(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>);
<a name="l00710"></a>00710                         }
<a name="l00711"></a>00711                 InfoMessage(KCreateHistogram);
<a name="l00712"></a>00712         
<a name="l00713"></a>00713                 <span class="comment">// Starts getting histogram notifications               </span>
<a name="l00714"></a>00714                 TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,hist-&gt;StartHistogramL(histhandle));
<a name="l00715"></a>00715                 InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KHistStart, KHistStartErr);  
<a name="l00716"></a>00716             
<a name="l00717"></a>00717                 <span class="comment">// After a KUidECamEventCameraHistogram event is received in HandleEventL(), a  </span>
<a name="l00718"></a>00718                 <span class="comment">// histogram data buffer can be obtained using HistogramDataL(). The data buffer</span>
<a name="l00719"></a>00719                 <span class="comment">// should be released after use, using MHistogramBuffer::Release().</span>
<a name="l00720"></a>00720                 <span class="comment">// TRAP(error,MHistogramBuffer&amp; buffer = hist-&gt;HistogramDataL());</span>
<a name="l00721"></a>00721         
<a name="l00722"></a>00722                 <span class="comment">// Stops getting histogram notifications</span>
<a name="l00723"></a>00723                 TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, hist-&gt;StopHistogramL(histhandle));
<a name="l00724"></a>00724         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KHistStop, KHistStopErr);
<a name="l00725"></a>00725         
<a name="l00726"></a>00726                 <span class="comment">// Destroys the histogram on the ECam server and releases its handle</span>
<a name="l00727"></a>00727         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, hist-&gt;DestroyHistogramL(histhandle));
<a name="l00728"></a>00728                 InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KDestroyHistogram,KDestroyHistogramErr);
<a name="l00729"></a>00729         
<a name="l00730"></a>00730                 }
<a name="l00731"></a>00731                 <span class="keywordflow">else</span>
<a name="l00732"></a>00732                 {
<a name="l00733"></a>00733                 InfoMessage(KNotSupported);
<a name="l00734"></a>00734                 User::Leave(KErrNotSupported);    
<a name="l00735"></a>00735                 }
<a name="l00736"></a>00736                 CleanupStack::PopAndDestroy(hist);
<a name="l00737"></a>00737         }
<a name="l00738"></a>00738 
<a name="l00746"></a><a class="code" href="class_c_camera_app_ui.html#2278865a43dad9483da33e886ee04011">00746</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#2278865a43dad9483da33e886ee04011">CCameraAppUi::OverLayL</a>()
<a name="l00747"></a>00747         {
<a name="l00748"></a>00748         CCamera::CCameraOverlay* overlay = NULL;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750         TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay = CCamera::CCameraOverlay::NewL(*iCamera));
<a name="l00751"></a>00751         <span class="keywordflow">if</span> (overlay == NULL)
<a name="l00752"></a>00752                 {
<a name="l00753"></a>00753                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00754"></a>00754                 <span class="keywordflow">return</span>;
<a name="l00755"></a>00755                 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757         CleanupStack::PushL(overlay);
<a name="l00758"></a>00758         
<a name="l00759"></a>00759         CFbsBitmap* bitmap = <span class="keyword">new</span> (ELeave) CFbsBitmap;
<a name="l00760"></a>00760         CleanupStack::PushL(bitmap);            
<a name="l00761"></a>00761         
<a name="l00762"></a>00762         <span class="comment">// Creates an overlay of hardcoded size 20x20</span>
<a name="l00763"></a>00763         User::LeaveIfError(bitmap-&gt;Create(TSize(20,20), EColor16M));
<a name="l00764"></a>00764 
<a name="l00765"></a>00765         CCamera::CCameraOverlay::TOverlayParameters parameters;
<a name="l00766"></a>00766         
<a name="l00767"></a>00767         CCamera::CCameraOverlay::TOverlaySupportInfo suppInfo;
<a name="l00768"></a>00768         <span class="comment">// Gets information on the overlay functionality supported by the ECam server.</span>
<a name="l00769"></a>00769         overlay-&gt;GetOverlaySupport(suppInfo);
<a name="l00770"></a>00770         
<a name="l00771"></a>00771         TUint currentModes = suppInfo.iSupportedModes;
<a name="l00772"></a>00772         <span class="keywordflow">if</span>(currentModes &amp; CCamera::CCameraOverlay::EModeStillImage)
<a name="l00773"></a>00773                 {
<a name="l00774"></a>00774                 <span class="comment">// Sets the camera mode in which the image overlay can be used.</span>
<a name="l00775"></a>00775                 parameters.iCurrentModes = CCamera::CCameraOverlay::EModeStillImage;
<a name="l00776"></a>00776                 InfoMessage(KOverLayMode);
<a name="l00777"></a>00777                 }
<a name="l00778"></a>00778         <span class="keywordflow">else</span>
<a name="l00779"></a>00779                 {
<a name="l00780"></a>00780                 InfoMessage(KOverLayModeErr);
<a name="l00781"></a>00781                 User::Leave(KErrNotSupported);
<a name="l00782"></a>00782                 }
<a name="l00783"></a>00783                 
<a name="l00784"></a>00784         TUint currentTypes = suppInfo.iSupportedTypes;
<a name="l00785"></a>00785         <span class="keywordflow">if</span>(currentTypes &amp; CCamera::CCameraOverlay::EPerPixel)
<a name="l00786"></a>00786                 {
<a name="l00787"></a>00787                 <span class="comment">// Sets the camera type in which the image overlay can be used</span>
<a name="l00788"></a>00788                 parameters.iCurrentTypes = CCamera::CCameraOverlay::EPerPixel;
<a name="l00789"></a>00789                 InfoMessage(KOverlayType);
<a name="l00790"></a>00790                 <span class="comment">// Sets the camera type to EPerPixel needs this value to be set to zero.</span>
<a name="l00791"></a>00791                 parameters.iAlphaValue = 0;     
<a name="l00792"></a>00792                 }
<a name="l00793"></a>00793         <span class="keywordflow">else</span>
<a name="l00794"></a>00794                 {
<a name="l00795"></a>00795                 InfoMessage(KCurrentTypeErr);
<a name="l00796"></a>00796                 User::Leave(KErrNotSupported);
<a name="l00797"></a>00797                 }
<a name="l00798"></a>00798         
<a name="l00799"></a>00799         <span class="comment">// Sets the size of the overlay image in pixels.        </span>
<a name="l00800"></a>00800         <span class="comment">//parameters.Size() = TSize(20,20);</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802         <span class="comment">// Top left corner within the original image, where the overlay image is to be blended.         </span>
<a name="l00803"></a>00803         parameters.iPosition = TPoint(2,2);     
<a name="l00804"></a>00804         
<a name="l00805"></a>00805         <span class="comment">// The z-order of the overlay to indicate depth </span>
<a name="l00806"></a>00806         parameters.iZOrder = 1;
<a name="l00807"></a>00807         
<a name="l00808"></a>00808         <span class="comment">// Creates an image overlay object on the ECam server.</span>
<a name="l00809"></a>00809         <span class="comment">// Returns handle to the newly created object.</span>
<a name="l00810"></a>00810         TUint overlayHandle =0; 
<a name="l00811"></a>00811         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlayHandle = overlay-&gt;CreateOverlayL(parameters, bitmap));
<a name="l00812"></a>00812         <span class="keywordflow">if</span>(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>!= KErrNone)
<a name="l00813"></a>00813                 {
<a name="l00814"></a>00814                 InfoMessage(KCreateoverlayErr);
<a name="l00815"></a>00815                 User::Leave(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>);     
<a name="l00816"></a>00816                 }
<a name="l00817"></a>00817         
<a name="l00818"></a>00818         InfoMessage(KCreateoverlay);
<a name="l00819"></a>00819         
<a name="l00820"></a>00820         <span class="comment">// Allows the overlay image data to be changed if it was </span>
<a name="l00821"></a>00821         <span class="comment">// not specified when the overlay was created using CreateOverlayL()</span>
<a name="l00822"></a>00822         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay-&gt;SetOverlayBitmapL(overlayHandle, bitmap));
<a name="l00823"></a>00823         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KSetoverlayBmp, KSetoverlayBmpErr);  
<a name="l00824"></a>00824 
<a name="l00825"></a>00825         <span class="comment">// Gets the overlay image data for a specified overlay.</span>
<a name="l00826"></a>00826         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay-&gt;GetOverlayBitmapL(overlayHandle, bitmap));
<a name="l00827"></a>00827         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KGetoverlayBmp, KGetoverlayBmpErr);  
<a name="l00828"></a>00828 
<a name="l00829"></a>00829         <span class="comment">// Gets the parameters that characterize a given overlay.</span>
<a name="l00830"></a>00830         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay-&gt;GetOverlayParametersL(overlayHandle, parameters));
<a name="l00831"></a>00831         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KGetoverlayParams, KGetoverlayParamsErr);    
<a name="l00832"></a>00832         
<a name="l00833"></a>00833         <span class="comment">// Sets new parameters that characterize a given overlay.       </span>
<a name="l00834"></a>00834         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay-&gt;SetOverlayParametersL(overlayHandle, parameters));
<a name="l00835"></a>00835         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KSetoverlayParams, KSetoverlayParamsErr);    
<a name="l00836"></a>00836          
<a name="l00837"></a>00837         RArray&lt;TUint&gt; overlayHandlesArray;
<a name="l00838"></a>00838         <span class="comment">// Gets all the overlay handles maintained by the ECam server. </span>
<a name="l00839"></a>00839         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay-&gt;GetAllOverlaysInZOrderL(overlayHandlesArray));
<a name="l00840"></a>00840         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KGetAllOverlays, KGetAllOverlaysErr);        
<a name="l00841"></a>00841                 
<a name="l00842"></a>00842     <span class="comment">// Releases the overlay handle.</span>
<a name="l00843"></a>00843     TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, overlay-&gt;ReleaseOverlay(overlayHandle));
<a name="l00844"></a>00844     InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,KReleaseOverlay, KReleaseOverlayErr);
<a name="l00845"></a>00845     
<a name="l00846"></a>00846         CleanupStack::PopAndDestroy(2, overlay); <span class="comment">//bitmap, overlay</span>
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00856"></a><a class="code" href="class_c_camera_app_ui.html#2315d6c9b627e6d2abc0568d8e40bcd0">00856</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#2315d6c9b627e6d2abc0568d8e40bcd0">CCameraAppUi::PresetL</a>()
<a name="l00857"></a>00857         {
<a name="l00858"></a>00858         CCamera::CCameraPresets* presets = NULL;
<a name="l00859"></a>00859         TRAPD(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, presets  = CCamera::CCameraPresets::NewL(*iCamera));
<a name="l00860"></a>00860         <span class="keywordflow">if</span> (presets == NULL)
<a name="l00861"></a>00861                 {
<a name="l00862"></a>00862                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00863"></a>00863                 <span class="keywordflow">return</span>;
<a name="l00864"></a>00864                 }
<a name="l00865"></a>00865         
<a name="l00866"></a>00866         CleanupStack::PushL(presets);
<a name="l00867"></a>00867         
<a name="l00868"></a>00868         <span class="comment">// Gets the supported set of values  </span>
<a name="l00869"></a>00869         RArray&lt;TUid&gt; resultSet;
<a name="l00870"></a>00870         
<a name="l00871"></a>00871         <span class="comment">// Gets the presets supported by the camera. </span>
<a name="l00872"></a>00872         <span class="comment">// These are identified by UIDs and relate to a known predefined outcome. </span>
<a name="l00873"></a>00873         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,presets-&gt;GetSupportedPresetsL(resultSet));
<a name="l00874"></a>00874         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,KSupportedPresets, KEmptyArray);
<a name="l00875"></a>00875                 
<a name="l00876"></a>00876         <span class="comment">// Sets preset after checking if it is supported</span>
<a name="l00877"></a>00877         TUid inputEventUid = KUidECamPresetOutdoor;
<a name="l00878"></a>00878         TInt index = resultSet.Find(inputEventUid);
<a name="l00879"></a>00879         <span class="keywordflow">if</span>(index == -1)
<a name="l00880"></a>00880                 {
<a name="l00881"></a>00881                 User::Leave(KErrNotFound);      
<a name="l00882"></a>00882                 }
<a name="l00883"></a>00883         
<a name="l00884"></a>00884         presets-&gt;SetPreset(inputEventUid);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <span class="comment">// All the settings which are related to the preset in question will </span>
<a name="l00887"></a>00887         <span class="comment">// be included in the list, even though the value might not have changed.</span>
<a name="l00888"></a>00888         TRAP(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>,presets-&gt;GetAffectedSettingsL(resultSet));
<a name="l00889"></a>00889         
<a name="l00890"></a>00890         InfoMessage(<a class="code" href="_camera___app_ui_8cpp.html#711e7d3cb49b7e0de7880fed269134d3">error</a>, KGetAffectedSettings, KGetAffectedSettingsErr);
<a name="l00891"></a>00891         resultSet.Reset();
<a name="l00892"></a>00892         CleanupStack::PopAndDestroy(presets);
<a name="l00893"></a>00893         }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 
<a name="l00902"></a><a class="code" href="class_c_camera_app_ui.html#6f7cc6d4b34efada215a7ebe1a9e73d8">00902</a> <span class="keywordtype">void</span> <a class="code" href="class_c_camera_app_ui.html#6f7cc6d4b34efada215a7ebe1a9e73d8">CCameraAppUi::ImageProcessingL</a>()
<a name="l00903"></a>00903         {
<a name="l00904"></a>00904         CCamera::CCameraImageProcessing* imageprocess = NULL;
<a name="l00905"></a>00905         imageprocess = CCamera::CCameraImageProcessing::NewL(*iCamera);
<a name="l00906"></a>00906         <span class="keywordflow">if</span> (imageprocess == NULL)
<a name="l00907"></a>00907                 {
<a name="l00908"></a>00908                 iEikonEnv-&gt;InfoMsg(KFeatureNotSupported);
<a name="l00909"></a>00909                 <span class="keywordflow">return</span>;
<a name="l00910"></a>00910                 }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         CleanupStack::PushL(imageprocess);
<a name="l00913"></a>00913         
<a name="l00914"></a>00914         <span class="comment">// Gets array of supported transformations</span>
<a name="l00915"></a>00915         RArray&lt;TUid&gt; supportedTransforms;       
<a name="l00916"></a>00916     CleanupClosePushL(supportedTransforms);     
<a name="l00917"></a>00917         imageprocess-&gt;GetSupportedTransformationsL(supportedTransforms);
<a name="l00918"></a>00918         
<a name="l00919"></a>00919         <span class="comment">// Uses the adjust brightness transformation</span>
<a name="l00920"></a>00920         TUid transformUid = KUidECamEventImageProcessingAdjustBrightness;
<a name="l00921"></a>00921         <span class="keywordflow">if</span> (supportedTransforms.Find(transformUid) != KErrNotFound)
<a name="l00922"></a>00922                 {
<a name="l00923"></a>00923                 <span class="comment">// Reads a list of the supported effects into an array</span>
<a name="l00924"></a>00924                 RArray&lt;TInt&gt; supportedValues;
<a name="l00925"></a>00925             CleanupClosePushL(supportedValues);                         
<a name="l00926"></a>00926                 TValueInfo info = ENotActive;
<a name="l00927"></a>00927                 imageprocess-&gt;GetTransformationSupportedValuesL(transformUid, supportedValues, info);
<a name="l00928"></a>00928                 
<a name="l00929"></a>00929                 <span class="comment">// For the brightness transform, expects supported values to give the minimum and maximum range</span>
<a name="l00930"></a>00930                 <span class="keywordflow">if</span> (info == EContinuousRangeMinMax) 
<a name="l00931"></a>00931                         {                       
<a name="l00932"></a>00932                         <span class="comment">// Adjusts brightness by the first of the supported values</span>
<a name="l00933"></a>00933                         TInt brightValue = supportedValues[1];
<a name="l00934"></a>00934                         imageprocess-&gt;SetTransformationValue(transformUid, brightValue);
<a name="l00935"></a>00935                         InfoMessage(KSetBrightness);
<a name="l00936"></a>00936                         }
<a name="l00937"></a>00937                 CleanupStack::PopAndDestroy(); <span class="comment">// supportedValues</span>
<a name="l00938"></a>00938                 }
<a name="l00939"></a>00939         
<a name="l00940"></a>00940         <span class="comment">// Uses the monochrome effect   </span>
<a name="l00941"></a>00941         transformUid = KUidECamEventImageProcessingEffect;
<a name="l00942"></a>00942         <span class="keywordflow">if</span> (supportedTransforms.Find(transformUid) != KErrNotFound)
<a name="l00943"></a>00943                 {
<a name="l00944"></a>00944                 <span class="comment">// Reads a list of the supported effects into an array</span>
<a name="l00945"></a>00945                 RArray&lt;TInt&gt; supportedValues;
<a name="l00946"></a>00946             CleanupClosePushL(supportedValues);                         
<a name="l00947"></a>00947                 TValueInfo info = ENotActive;
<a name="l00948"></a>00948                 imageprocess-&gt;GetTransformationSupportedValuesL(transformUid, supportedValues, info);
<a name="l00949"></a>00949                 <span class="comment">// For effects, expects first member of the supported values to a bitfield of the supported effects</span>
<a name="l00950"></a>00950                 TInt effects = supportedValues[0];
<a name="l00951"></a>00951                 CleanupStack::PopAndDestroy(); <span class="comment">// supportedValues               </span>
<a name="l00952"></a>00952                 <span class="keywordflow">if</span>(effects &amp; CCamera::CCameraImageProcessing::EEffectMonochrome)
<a name="l00953"></a>00953                 {       
<a name="l00954"></a>00954                         imageprocess-&gt;SetTransformationValue(transformUid, CCamera::CCameraImageProcessing::EEffectMonochrome);
<a name="l00955"></a>00955                         InfoMessage(KImageEffect);
<a name="l00956"></a>00956                         }
<a name="l00957"></a>00957                 }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959         CleanupStack::PopAndDestroy(2); <span class="comment">//supportedTransforms, imageprocess</span>
<a name="l00960"></a>00960         }
<a name="l00961"></a>00961 
<a name="l00967"></a>00967 <span class="keywordtype">void</span> CCameraAppUi::InfoMessage(<span class="keyword">const</span> TDesC&amp; aMsg)
<a name="l00968"></a>00968         {
<a name="l00969"></a>00969         iEikonEnv-&gt;InfoMsg(aMsg);
<a name="l00970"></a>00970         User::After(500000); <span class="comment">// pause .5 seconds</span>
<a name="l00971"></a>00971         }
<a name="l00972"></a>00972 
<a name="l00980"></a>00980 <span class="keywordtype">void</span> CCameraAppUi::InfoMessage(TInt aError, <span class="keyword">const</span> TDesC&amp; aSuccessMsg, <span class="keyword">const</span> TDesC&amp; aErrMsg)
<a name="l00981"></a>00981         {
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (aError==KErrNone) iEikonEnv-&gt;InfoMsg(aSuccessMsg); <span class="keywordflow">else</span> iEikonEnv-&gt;InfoMsg(aErrMsg);
<a name="l00983"></a>00983         User::After(500000); <span class="comment">// pause .5 seconds</span>
<a name="l00984"></a>00984         }
<a name="l00985"></a>00985 
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Thu Jan 21 10:32:59 2010 for TB10.1 Example Applications by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
