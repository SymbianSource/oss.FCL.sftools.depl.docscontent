<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) 2007-2010 Nokia Corporation and/or its subsidiary(-ies) All rights reserved. -->
<!-- This component and the accompanying materials are made available under the terms of the License 
"Eclipse Public License v1.0" which accompanies this distribution, 
and is available at the URL "http://www.eclipse.org/legal/epl-v10.html". -->
<!-- Initial Contributors:
    Nokia Corporation - initial contribution.
Contributors: 
-->
<!DOCTYPE concept
  PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept xml:lang="en" id="GUID-3D577CFE-A6C7-5C4C-A9AA-9382A062A3BE"><title>Animation Overview</title><prolog><metadata><keywords/></metadata></prolog><conbody><p>This topic provides an overview of the Animation API, which third-parties can use to create Window Server plug-in DLLs to perform animations. </p> <section><title>Introduction</title> <p>An animation DLL performs drawing from within the Window Server thread. This makes the continuous updating of graphics possible, because the Window Server thread has high priority and is unlikely to be pre-empted by other threads. Animation DLLs can be used to create animation effects that rely on continual and fast graphic updates—for example, to make a clock second hand sweep smoothly. This approach might even be exploited for video-style animations although its intended use is for drawn rather than bitmap graphics. </p> <p>A distinction between animated graphics and animated bitmaps is worth making. The animation classes are intended primarily for line drawing based animation. Bitmaps can be animated using either the animation classes or sprites, but sprites are usually preferred. Sprites animate arbitrary bitmaps. Typical uses are for cursors, PacMan style games, and so on. Because the Window Server handles much of the complexity, sprites can be thought of as bulletproof. The animation classes on the other hand provide server side speed and great flexibility, but are more complex to use. </p> <p>It is possible to create animation effects using ordinary Window Server clients, for example using active objects on the client side to schedule graphics updates. However, these suffer from the (relatively) lower priority of the client thread and from the fact that active objects are non-preemptively scheduled, which means that the window update can be delayed by other client-side active objects. </p> <p>An animation DLL also provides accurate clock ticks. Suppose you require a one second timer to move the second hand on a clock. If you work on the client side, then drift occurs with the clock losing time very gradually. The animation DLL provides access to timers that do not suffer from this problem. </p> <p>The Animation classes form two pairs across the client/server boundary. One pair provides functions at DLL level and the other at the level of individual animation classes. To create an animation requires a DLL class and a class for each animated object. More accurately, a pair of classes is required for each, with each pair comprising one server side class and one client side class. </p> <p>This general mechanism allows client/server separation while also allowing client side classes to benefit from server side privilege—fast graphical updates made possible by the high priority of the server thread. </p> <p>For efficiency reasons, it makes sense to collect multiple animation classes into a single DLL, even if they are otherwise logically quite separate classes. </p> </section> <section><title>Architectural relationships</title> <p>This API defines a framework for polymorphic DLLs that perform animations. These animation DLLs plug in to the Window Server, and so are run in the Window Server's high-priority thread, rather than the application thread. </p> <p>The Window Server Client-Side API defines base classes for client interfaces that applications use to control animation DLLs. Providers of animation DLLs specialize these client interfaces appropriately. </p> </section> <section><title>Description</title> <p>The API has four key concepts: animation factory, animation base class, window animation base class, and sprite animation base class. </p> <p><b>Animation factory </b> </p> <p>Each animation DLL must define a factory for the animations it provides. The DLL must export at ordinal 1 a function to create an instance of this factory class. </p> <p>The base class for such factories is <xref href="GUID-9E598CDA-6483-3AE3-ABFF-0F701A47AB84.dita"><apiname>CAnimDll</apiname></xref>. </p> <p><b>Animation base class </b> </p> <p>Every animation implements an interface that is called by the Window Server to: </p> <ul><li id="GUID-9BECB813-B5C5-5ABB-A5D5-3191D0A69A48"><p>pass commands from clients </p> </li> <li id="GUID-F71ACC22-D872-5DF6-9F6A-089718C7FA08"><p>perform a step in the animation </p> </li> <li id="GUID-6B7EC297-617F-5745-856F-C4EF99F19E37"><p>pass Window Server events (if required), so that the animation can handle them before the application </p> </li> </ul> <p>This interface is <xref href="GUID-029C644B-BE0F-37C6-95E2-D27F974E6AD3.dita"><apiname>CAnim</apiname></xref>, with its base class <xref href="GUID-F1B47E38-4585-3903-93C7-0BCB075465AA.dita"><apiname>MEventHandler</apiname></xref>. The operation to perform an animation step is called by the Window Server on a timer. The animation is informed if for any reason timer events are missed or become out of sync. The timing properties are set through an <xref href="GUID-FFE76181-A701-374B-82AA-CEACC5856E91.dita"><apiname>MAnimGeneralFunctions</apiname></xref> member (an abstract interface that is implemented by the Window Server). This also provides other utility functions. </p> <p><b>Window animation base class </b> </p> <p>For animations other than sprites, animation providers derive classes from the window animation base class, <xref href="GUID-70AB2433-00C7-3E49-BD6A-CC90E20DA7AE.dita"><apiname>CWindowAnim</apiname></xref>, based on <xref href="GUID-029C644B-BE0F-37C6-95E2-D27F974E6AD3.dita"><apiname>CAnim</apiname></xref>. This adds access to an interface for querying and manipulating the window in which the animation takes place, <xref href="GUID-6FB00D2D-3CFB-3CD8-9081-2FBD0E4A9AAF.dita"><apiname>MAnimWindowFunctions</apiname></xref>. </p> <p>A further specialized base class allows animations to be provided that implement their own animation timers. This is <xref href="GUID-BC3E6CD0-4678-36F6-B4D3-AEE4C6672AAE.dita"><apiname>CFreeTimerWindowAnim</apiname></xref>, based on <xref href="GUID-70AB2433-00C7-3E49-BD6A-CC90E20DA7AE.dita"><apiname>CWindowAnim</apiname></xref>, with related utility functions provided by <xref href="GUID-97545C9D-7CC7-36CB-851C-2CD272CA8EFD.dita"><apiname>MAnimFreeTimerWindowFunctions</apiname></xref>. </p> <p><b>Sprite animation base class </b> </p> <p>Sprites are bitmaps that can overlay a window. A sprite animation can be provided by deriving a class from <xref href="GUID-D49CF183-BD61-3E3E-A77F-C63845E6F0DF.dita"><apiname>CSpriteAnim</apiname></xref>, based on <xref href="GUID-029C644B-BE0F-37C6-95E2-D27F974E6AD3.dita"><apiname>CAnim</apiname></xref>. This adds access to an interface for querying and manipulating a sprite, <xref href="GUID-F1DC2E39-9AB1-397A-BEDD-036BB6C54EC4.dita"><apiname>MAnimSpriteFunctions</apiname></xref>. </p> </section> </conbody><related-links><link href="GUID-FAF1B60A-A4B5-5E45-B9B9-84DA982F2E2B.dita"><linktext>Animations</linktext> </link> </related-links></concept>